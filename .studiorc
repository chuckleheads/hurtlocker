RED='\033[0;31m'
NO_COLOR='\033[0m'

install-packages() {
  hab pkg install \
  core/cacerts \
  core/net-tools \
  core/procps-ng \
  core/curl \
  -b -c stable
}

no_install_deps() {
  local file="/src/cleanup"
  if [ ! -f "$file" ]; then
    touch "$file"
  else
    echo "1"
  fi
}

# Cleanup any development touch files we laid down when checking to see if we could run NO_INSTALL_DEPS
_cleanup() {
  if [ -f "/src/cleanup" ]; then
    rm "/src/cleanup"
  fi
}

start-hurtlocker() {
  start-datastore
  start-originsrv
  start-gateway
}

start-datastore() {
  hab svc load chuckleheads/builder-datastore
}

stop-datastore() {
  hab svc unload chuckleheads/builder-datastore
}

start-originsrv() {
  hab svc load chuckleheads/originsrv
}

stop-originsrv() {
  hab svc unload chuckleheads/originsrv
}

start-gateway() {
    hab svc load chuckleheads/builder-gateway
}

stop-gateway() {
    hab svc unload chuckleheads/builder-gateway
}

build-gateway() {
  stop-gateway
  NO_INSTALL_DEPS=$(no_install_deps "builder-$component") \
    build ./habitat-dev
  start-api
}

trap _cleanup EXIT

install-packages
